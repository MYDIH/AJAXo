var AjaxHandler=new function(){this.pages=[];this.usedLoader=this.usedGlobalContainer=this.usedContainer=null;this.container="#PageContainer";this.globalContainer="#PageGlobalContainer";this.loader="#LoaderContainer";this.queue=[];this.pageIsLoading=!1;this.addAPage=function(a){a.hasOwnProperty("load")&&a.hasOwnProperty("name")?this.pages.push(a):console.log("AJAXo : Trying to add an invalid page.")};this.startAjaxHandling=function(a){$(window).on("statechange",function(){var a=History.getState();
AjaxHandler.loadPageByName(a.data.page,a.data)});$(document).on("ajaxhandler.load.finished.normalHandle",function(){AjaxHandler.pageIsLoading=!1;AjaxHandler.launchFollowingPage();return!1});var b=URLParser.parse(window.location);return null!=b?(AjaxHandler.changePage(b.page,b,a,!0),!0):!1};this.addToQueue=function(a,b){this.queue.push([a,b])};this.launchFollowingPage=function(){var a=this.queue.shift();"undefined"!=typeof a?this.loadPage(a[0],a[1]):$(document).trigger("ajaxhandler.load.finished.specialHandle")};
this.synchronize=function(a,b){var c="used"+b[0].toUpperCase()+b.slice(1);a.hasOwnProperty(b)?this[c]=a[b]:this[c]=this[b]};this.syncPageWithHandler=function(a){this.synchronize(a,"container");this.synchronize(a,"globalContainer");this.synchronize(a,"loader")};this.changePage=function(a,b,c,e){b=b||{};c=c||"";e=e||!1;b.page=a;b.randomData=window.Math.random();a="";for(var d in b)b.hasOwnProperty(d)&&"randomData"!=d&&(a=""==a?a+(d+"="+encodeURIComponent(b[d])):a+("&"+d+"="+encodeURIComponent(b[d])));
e?History.replaceState(b,"","?"+a):History.pushState(b,"","?"+a);""!==c&&(document.title=c)};this.loadPage=function(a,b){var c=null;"undefined"==typeof b&&(b={});a.hasOwnProperty("beforeLoad")&&(c=a.beforeLoad);this.pageIsLoading?this.addToQueue(a,b):(this.syncPageWithHandler(a),this.pageIsLoading=!0,this.loadAjaxPageWithLoader(a,b,function(c){a.load(b,c)},c))};this.loadPageComponent=function(a,b){return this.loadPage(a,b)};this.loadPageComponentById=function(a,b,c){return this.loadPageComponent(a.components[b],
c)};this.loadPageComponentByName=function(a,b,c){for(var e=0;e<this.pages.length;e++)if(this.pages[e].name==a)for(var d=0;d<this.pages[e].components.length;d++)if(this.pages[e].components[d].name==b)return this.loadPageComponent(this.pages[e].components[d],c);return!1};this.loadPageByName=function(a,b){for(var c=0;c<this.pages.length;c++)if(this.pages[c].name==a)return this.loadPage(this.pages[c],b);return!1};this.loadAjaxPage=function(a,b,c,e){c=c||function(){};$.ajax({url:"pages/"+a+".php",type:"POST",
dataType:"html",data:b||"",success:function(a){var b;try{b=$(a).find('input[name="AjaxRedirect"]').length}catch(e){b=!1}b?window.location.replace($(a).find('input[name="AjaxRedirect"]').val()):c(a)},error:e||function(){}})};this.loadAjaxPageWithLoader=function(a,b,c,e,d){e=e||function(){return!0};var h=!1;$(this.usedContainer).fadeOut("fast",function(){$(AjaxHandler.usedLoader).fadeIn("fast",function(){AjaxHandler.loadAjaxPage(a.name,$.param(b),function(d){var f=[d];if(e(f))if($(AjaxHandler.usedContainer).remove(),
$(f[0]).appendTo($(AjaxHandler.usedGlobalContainer)),"undefined"!==typeof a.loadComponents&&0<a.loadComponents.length){for(var g=0;g<a.loadComponents.length;g++)AjaxHandler.loadPageComponentById(a,a.loadComponents[g],b);h=!0;$(document).on("ajaxhandler.load.finished.specialHandle",function(){$(document).off("ajaxhandler.load.finished.specialHandle");AjaxHandler.syncPageWithHandler(a);$(AjaxHandler.usedLoader).fadeOut("fast",function(){$(AjaxHandler.usedContainer).fadeIn("fast");$(document).trigger("ajaxhandler.load.finished.normalHandle");
c(f[d])})})}else $(AjaxHandler.usedLoader).fadeOut("fast",function(){$(AjaxHandler.usedContainer).fadeIn("fast");$(document).trigger("ajaxhandler.load.finished.normalHandle")});else $(AjaxHandler.usedLoader).fadeOut("fast",function(){$(AjaxHandler.usedContainer).fadeIn("fast");$(document).trigger("ajaxhandler.load.finished.normalHandle")});h?$(document).trigger("ajaxhandler.load.finished.normalHandle"):c(f[d])},d)})})};this.reloadPage=function(){var a=History.getState();a.data.randomData=window.Math.random();
var b=$.param(a.data).replace("&randomData="+a.data.randomData,"");History.replaceState(a.data,"","?"+b)}},URLParser=new function(){this.parse=function(a){a=decodeURIComponent(a.search.substring(1)).split("&");var b={},c=!1,e;for(e in a){var d=a[e].split("=");"page"==d[0]&&(c=!0);b[d[0]]=d[1]}return c?b:null}};
